# eCAL Pub/Sub Configuration Benchmarks

This document describes a suite of microbenchmarks that compare publish-side performance across multiple shared-memory configuration variants.

---

## Benchmark set

Seven variants are registered; each publishes randomly generated byte payloads on `benchmark_topic` while a subscriber is running in a background thread to keep the writer matched.

| Variant | Zero‑copy | Double buffer | Handshake (ack timeout) |
|---|:---:|:---:|:---:|
| Send_Zero_Copy | ✓ | – | – |
| Send_Handshake | – | – | ✓ (50 ms) |
| Send_Double_Buffer | – | ✓ (2 buffers) | – |
| Send_Zero_Copy_Handshake | ✓ | – | ✓ (50 ms) |
| Send_Zero_Copy_Double_Buffer | ✓ | ✓ (2 buffers) | – |
| Send_Double_Buffer_Handshake | – | ✓ (2 buffers) | ✓ (50 ms) |
| Send_Zero_Copy_Double_Buffer_Handshake | ✓ | ✓ (2 buffers) | ✓ (50 ms) |

---

### Common behavior

- **Payload sizes:** Sweep from **1 B** to **16 MiB** with a **×64** multiplier (1, 64, 4096, 262 144, 16 777 216 bytes).
- **Registration delay:** Wait **2000 ms** before measuring to allow publisher/subscriber discovery.
- **Receiver loop:** Background subscriber thread stays alive; it sleeps for ~10 ms per loop iteration.
- **Benchmark timing:** `UseRealTime()`; reported throughput is derived by Google Benchmark from the measured wall time.

> **Note**: All results reflect **single‑process, intra‑host** behavior. Cross‑process or cross‑host transport effects are not isolated by this setup.

---

## Configuration options

The following parameters are set:

- **Payload range**: `range_start`, `range_limit`, `range_multiplier` (default: 1 → 16 MiB, ×64 steps).
- **Registration delay**: `registration_delay_ms` (default: 2000 ms).
- **Ack timeout**: `ack_timeout_ms` (default: 50 ms) for handshake variants.
- **Zero‑copy enable**: `pub_config.layer.shm.zero_copy_mode = true` (per variant).
- **Double buffering**: `pub_config.layer.shm.memfile_buffer_count = 2` (per variant).